#include <gb/gb.h>
#include <stdio.h>
#include <gb/drawing.h>
// #include "text.c"

// #include "LaroldsJubilantJunkyard.h"
// #include "datas.c"

const unsigned char background_tileset[] =
{
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x6A,0xBF,0x53,0xED,0xDD,0xBA,0x21,0xFF,
    0x36,0xCD,0x4A,0xFF,0x6A,0xBF,0xA3,0xFD,
    0xB7,0xFF,0xBE,0xFF,0xD9,0xFF,0xCF,0xFF,
    0xFF,0xFF,0x99,0xFF,0x6D,0xFF,0xEE,0xFF,
    0x89,0x00,0x00,0x00,0x22,0x00,0xA8,0x00,
    0x01,0x10,0x41,0x10,0x08,0x4A,0x2A,0x2A,
    0x04,0x00,0x40,0x00,0x12,0x00,0x80,0x00,
    0x02,0x00,0x28,0x01,0x00,0x49,0x49,0x49,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x88,0x00,0x00,0x00,0x00,0x00,0x22,0x00,
    0x00,0x00,0x84,0x00,0x20,0x00,0x00,0x00,
    0x08,0x00,0x80,0x00,0x20,0x00,0x01,0x00,
    0x00,0x00,0x20,0x00,0x02,0x00,0x80,0x00,

    0x3C, 0x3C, 0x66, 0x66, 0x66, 0x66, 0x7E, 0x7E, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x00, 0x00,
    0x7C, 0x7C, 0x66, 0x66, 0x66, 0x66, 0x7C, 0x7C, 0x66, 0x66, 0x66, 0x66, 0x7C, 0x7C, 0x00, 0x00,
    0x3C, 0x3C, 0x62, 0x62, 0x60, 0x60, 0x60, 0x60, 0x60, 0x60, 0x62, 0x62, 0x3C, 0x3C, 0x00, 0x00,
    0x7C, 0x7C, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x7C, 0x7C, 0x00, 0x00,
    0x7E, 0x7E, 0x60, 0x60, 0x60, 0x60, 0x7C, 0x7C, 0x60, 0x60, 0x60, 0x60, 0x7E, 0x7E, 0x00, 0x00,
    0x7E, 0x7E, 0x60, 0x60, 0x60, 0x60, 0x7C, 0x7C, 0x60, 0x60, 0x60, 0x60, 0x60, 0x60, 0x00, 0x00,
    0x3C, 0x3C, 0x62, 0x62, 0x60, 0x60, 0x6E, 0x6E, 0x66, 0x66, 0x66, 0x66, 0x3E, 0x3E, 0x00, 0x00,
    0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x7E, 0x7E, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x00, 0x00,
    0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x00, 0x00,
    0x06, 0x06, 0x06, 0x06, 0x06, 0x06, 0x06, 0x06, 0x06, 0x06, 0x46, 0x46, 0x3C, 0x3C, 0x00, 0x00,
    0x66, 0x66, 0x6C, 0x6C, 0x78, 0x78, 0x70, 0x70, 0x78, 0x78, 0x6C, 0x6C, 0x66, 0x66, 0x00, 0x00,
    0x60, 0x60, 0x60, 0x60, 0x60, 0x60, 0x60, 0x60, 0x60, 0x60, 0x60, 0x60, 0x7C, 0x7C, 0x00, 0x00,
    0xFC, 0xFC, 0xD6, 0xD6, 0xD6, 0xD6, 0xD6, 0xD6, 0xD6, 0xD6, 0xC6, 0xC6, 0xC6, 0xC6, 0x00, 0x00,
    0x62, 0x62, 0x72, 0x72, 0x7A, 0x7A, 0x5E, 0x5E, 0x4E, 0x4E, 0x46, 0x46, 0x42, 0x42, 0x00, 0x00,
    0x3C, 0x3C, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x3C, 0x3C, 0x00, 0x00,
    0x7C, 0x7C, 0x66, 0x66, 0x66, 0x66, 0x7C, 0x7C, 0x60, 0x60, 0x60, 0x60, 0x60, 0x60, 0x00, 0x00,
    0x3C, 0x3C, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x3C, 0x3C, 0x06, 0x06,
    0x7C, 0x7C, 0x66, 0x66, 0x66, 0x66, 0x7C, 0x7C, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x00, 0x00,
    0x3C, 0x3C, 0x62, 0x62, 0x70, 0x70, 0x3C, 0x3C, 0x0E, 0x0E, 0x46, 0x46, 0x3C, 0x3C, 0x00, 0x00,
    0x7E, 0x7E, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x00, 0x00,
    0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x3C, 0x3C, 0x00, 0x00,
    0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x64, 0x64, 0x78, 0x78, 0x00, 0x00,
    0xC6, 0xC6, 0xC6, 0xC6, 0xC6, 0xC6, 0xD6, 0xD6, 0xD6, 0xD6, 0xD6, 0xD6, 0xFC, 0xFC, 0x00, 0x00,
    0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x3C, 0x3C, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x00, 0x00,
    0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x3C, 0x3C, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x00, 0x00,
    0x7E, 0x7E, 0x0E, 0x0E, 0x1C, 0x1C, 0x38, 0x38, 0x70, 0x70, 0x60, 0x60, 0x7E, 0x7E, 0x00, 0x00,
    0x3C, 0x3C, 0x66, 0x66, 0x6E, 0x6E, 0x76, 0x76, 0x66, 0x66, 0x66, 0x66, 0x3C, 0x3C, 0x00, 0x00,
    0x18, 0x18, 0x38, 0x38, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x00, 0x00,
    0x3C, 0x3C, 0x66, 0x66, 0x0E, 0x0E, 0x1C, 0x1C, 0x38, 0x38, 0x70, 0x70, 0x7E, 0x7E, 0x00, 0x00,
    0x7E, 0x7E, 0x0C, 0x0C, 0x18, 0x18, 0x3C, 0x3C, 0x06, 0x06, 0x46, 0x46, 0x3C, 0x3C, 0x00, 0x00,
    0x0C, 0x0C, 0x1C, 0x1C, 0x2C, 0x2C, 0x4C, 0x4C, 0x7E, 0x7E, 0x0C, 0x0C, 0x0C, 0x0C, 0x00, 0x00,
    0x7E, 0x7E, 0x60, 0x60, 0x7C, 0x7C, 0x06, 0x06, 0x06, 0x06, 0x46, 0x46, 0x3C, 0x3C, 0x00, 0x00,
    0x1C, 0x1C, 0x20, 0x20, 0x60, 0x60, 0x7C, 0x7C, 0x66, 0x66, 0x66, 0x66, 0x3C, 0x3C, 0x00, 0x00,
    0x7E, 0x7E, 0x06, 0x06, 0x0E, 0x0E, 0x1C, 0x1C, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x00, 0x00,
    0x3C, 0x3C, 0x66, 0x66, 0x66, 0x66, 0x3C, 0x3C, 0x66, 0x66, 0x66, 0x66, 0x3C, 0x3C, 0x00, 0x00,
    0x3C, 0x3C, 0x66, 0x66, 0x66, 0x66, 0x3E, 0x3E, 0x06, 0x06, 0x0C, 0x0C, 0x38, 0x38, 0x00, 0x00,
    0x18, 0x18, 0x18, 0x18, 0x10, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3C, 0x3C, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x18, 0x18, 0x18, 0x18, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x30, 0x30, 0x30, 0x30, 0x20, 0x20,
    0x00, 0x00, 0x18, 0x18, 0x18, 0x18, 0x00, 0x00, 0x00, 0x00, 0x18, 0x18, 0x18, 0x18, 0x00, 0x00,
    0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x00, 0x00, 0x18, 0x18, 0x00, 0x00,
    0x3C, 0x3C, 0x46, 0x46, 0x06, 0x06, 0x0C, 0x0C, 0x18, 0x18, 0x18, 0x18, 0x00, 0x00, 0x18, 0x18,
    0x04, 0x04, 0x08, 0x08, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x08, 0x08, 0x04, 0x04,
    0x20, 0x20, 0x10, 0x10, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x10, 0x10, 0x20, 0x20,
    0x00, 0xFE, 0x7C, 0x82, 0x7C, 0x82, 0x7C, 0x82, 0x7C, 0x82, 0x7C, 0x82, 0x00, 0xFE, 0x00, 0x00,
    0xFF, 0xFF, 0x00, 0x00, 0xFF, 0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};

unsigned char sprite_tiles[] = {
  0x00,0x00,0x00,0x00,0x24,0x42,0x66,0x3C,
  0x18,0x24,0x00,0x3C,0x24,0x24,0x66,0x66,
  0x00,0x00,0x00,0x00,0x24,0x42,0x66,0x00,
  0x7E,0x24,0x00,0x3C,0x24,0x24,0x66,0x66,
  0x00,0x00,0x3C,0x3C,0x66,0x5A,0xDB,0xA5,
  0xFF,0xFF,0xAB,0xD5,0xD5,0xAB,0xFF,0xFF
};

unsigned char room_1[] = { 2, 2, 2, 2, 1, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 1, 2, 2, 2, 2, 2, 2, 1, 1, 1, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 1, 1, 1, 2, 2, 2, 2, 1, 1, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 1, 1, 1, 2, 2, 1, 1, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 1, 1, 2, 2, 1, 1, 7, 7, 3, 7, 7, 7, 7, 3, 7, 7, 7, 3, 7, 7, 7, 1, 2, 2, 1, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 1, 2, 2, 1, 7, 7, 7, 3, 7, 7, 7, 7, 4, 7, 4, 7, 7, 7, 7, 7, 1, 2, 1, 1, 7, 7, 7, 7, 7, 7, 3, 7, 7, 7, 7, 7, 7, 4, 3, 7, 1, 1, 2, 1, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 4, 7, 7, 7, 7, 1, 2, 1, 1, 7, 7, 7, 4, 7, 7, 4, 7, 7, 7, 7, 3, 7, 7, 7, 7, 1, 1, 2, 1, 7, 7, 7, 3, 7, 7, 7, 4, 7, 7, 7, 7, 7, 7, 7, 7, 1, 2, 1, 1, 7, 7, 7, 7, 7, 3, 7, 7, 7, 3, 7, 7, 7, 7, 7, 7, 1, 2, 2, 1, 7, 7, 7, 3, 7, 4, 7, 7, 7, 7, 7, 7, 4, 7, 7, 7, 1, 2, 2, 1, 3, 7, 7, 7, 7, 3, 7, 7, 7, 7, 7, 3, 7, 7, 7, 4, 1, 2, 2, 1, 1, 7, 7, 7, 7, 7, 7, 7, 4, 7, 7, 7, 7, 7, 7, 1, 1, 2, 2, 1, 1, 1, 1, 4, 7, 4, 7, 4, 7, 7, 7, 4, 7, 1, 1, 1, 2, 2, 2, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 2, 2, 2, 1, 2, 1, 2, 2, 2, 2, 2, 2, 2 };


unsigned char room_2[] = { 2, 2, 2, 2, 2, 2, 2, 2, 2, 7, 7, 7, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 1, 1, 1, 1, 1, 1, 7, 7, 7, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 1, 1, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 1, 1, 1, 2, 2, 1, 1, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 1, 1, 2, 2, 1, 1, 7, 7, 3, 7, 7, 7, 7, 3, 7, 7, 7, 3, 7, 7, 7, 1, 2, 2, 1, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 1, 2, 2, 1, 7, 7, 7, 3, 7, 7, 7, 7, 4, 7, 4, 7, 7, 7, 7, 7, 1, 2, 1, 1, 7, 7, 7, 7, 7, 7, 3, 7, 7, 7, 7, 7, 7, 4, 3, 7, 1, 1, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 4, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 4, 7, 7, 4, 7, 7, 7, 7, 3, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 3, 7, 7, 7, 4, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 1, 1, 7, 7, 7, 7, 7, 3, 7, 7, 7, 3, 7, 7, 7, 7, 7, 7, 1, 1, 2, 1, 7, 7, 7, 3, 7, 4, 7, 7, 7, 7, 7, 7, 4, 7, 7, 7, 1, 2, 2, 1, 3, 7, 7, 7, 7, 3, 7, 7, 7, 7, 7, 3, 7, 7, 7, 4, 1, 2, 2, 1, 1, 7, 7, 7, 7, 7, 7, 7, 4, 7, 7, 7, 7, 7, 7, 1, 1, 2, 2, 1, 1, 1, 1, 4, 7, 4, 7, 4, 7, 7, 7, 4, 7, 1, 1, 1, 2, 2, 2, 2, 1, 1, 1, 1, 1, 1, 1, 7, 7, 7, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 7, 7, 7, 1, 2, 2, 2, 2, 2, 2, 2 };


unsigned char room_3[] = { 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 1, 1, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 1, 1, 1, 2, 2, 1, 1, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 1, 1, 2, 2, 1, 1, 7, 7, 3, 1, 7, 7, 7, 3, 7, 7, 7, 1, 1, 7, 7, 1, 2, 2, 1, 7, 7, 7, 1, 2, 7, 7, 7, 7, 7, 7, 1, 1, 2, 7, 7, 1, 2, 2, 1, 7, 7, 7, 1, 2, 1, 7, 7, 4, 7, 4, 7, 1, 2, 1, 7, 1, 2, 2, 1, 7, 7, 7, 7, 1, 7, 3, 7, 7, 7, 7, 7, 7, 1, 3, 7, 1, 2, 2, 1, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 4, 7, 7, 7, 7, 1, 2, 2, 1, 7, 7, 7, 4, 7, 7, 4, 7, 7, 7, 7, 3, 7, 7, 7, 7, 1, 2, 2, 1, 7, 7, 7, 1, 7, 7, 7, 4, 7, 7, 7, 7, 7, 7, 7, 7, 1, 2, 2, 1, 7, 7, 1, 2, 7, 3, 7, 7, 7, 3, 7, 7, 1, 1, 7, 7, 1, 2, 2, 1, 7, 7, 7, 1, 7, 4, 7, 7, 7, 7, 7, 7, 4, 1, 7, 7, 1, 2, 2, 1, 3, 7, 7, 7, 7, 3, 7, 7, 7, 7, 7, 3, 7, 7, 7, 4, 1, 2, 2, 1, 1, 7, 7, 7, 7, 7, 7, 7, 4, 7, 7, 7, 7, 7, 7, 1, 1, 2, 2, 1, 1, 1, 1, 4, 7, 4, 7, 4, 7, 7, 7, 4, 7, 1, 1, 1, 2, 2, 2, 2, 1, 1, 1, 1, 1, 1, 1, 7, 7, 7, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 7, 7, 7, 1, 2, 2, 2, 2, 2, 2, 2 };
unsigned char *current_room = room_1;

unsigned char start_screen[] = { 2, 1, 1, 7, 3, 7, 7, 7, 7, 7, 7, 7, 7, 3, 7, 7, 1, 2, 2, 1, 2, 1, 1, 7, 7, 7, 3, 7, 7, 7, 7, 7, 7, 3, 7, 7, 1, 1, 2, 2, 2, 2, 1, 7, 7, 7, 7, 7, 7, 7, 3, 7, 7, 7, 3, 7, 1, 1, 2, 2, 2, 2, 1, 1, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 1, 2, 2, 2, 1, 1, 1, 7, 3, 7, 7, 7, 7, 3, 7, 7, 7, 3, 7, 7, 1, 1, 2, 2, 2, 1, 1, 7, 7, 7, 3, 7, 7, 7, 7, 7, 7, 7, 7, 7, 1, 1, 2, 2, 2, 2, 1, 7, 3, 7, 7, 7, 7, 4, 7, 4, 7, 7, 7, 7, 1, 2, 2, 1, 2, 2, 1, 7, 7, 7, 7, 3, 7, 7, 7, 7, 7, 7, 4, 1, 1, 2, 1, 2, 2, 2, 1, 7, 7, 7, 7, 7, 7, 7, 7, 7, 4, 7, 7, 1, 2, 2, 1, 2, 2, 1, 1, 7, 4, 7, 7, 4, 7, 7, 7, 7, 3, 7, 7, 1, 1, 2, 2, 2, 2, 1, 7, 7, 3, 7, 7, 7, 4, 7, 7, 7, 7, 7, 7, 7, 1, 2, 2, 2, 2, 1, 7, 7, 7, 7, 3, 7, 7, 7, 3, 7, 7, 7, 7, 7, 1, 2, 2, 2, 2, 1, 1, 7, 3, 7, 4, 7, 7, 7, 7, 7, 7, 4, 7, 7, 1, 1, 2, 2, 2, 2, 1, 7, 7, 7, 3, 7, 7, 7, 3, 7, 3, 7, 7, 7, 1, 2, 2, 1, 2, 2, 1, 7, 7, 7, 7, 7, 7, 4, 7, 7, 7, 7, 7, 7, 1, 2, 2, 2, 2, 1, 1, 7, 4, 7, 4, 7, 4, 7, 7, 7, 4, 7, 7, 1, 1, 2, 2, 2, 2, 1, 7, 7, 3, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 1, 2, 2, 1, 2, 1, 1, 7, 7, 7, 7, 7, 7, 3, 7, 3, 7, 7, 7, 7, 1, 2, 1, 1, 2, 1, 1, 7, 3, 7, 7, 7, 7, 7, 7, 7, 7, 3, 7, 7, 1, 2, 2, 1, 2, 1, 1, 7, 7, 7, 3, 7, 7, 7, 7, 7, 7, 3, 7, 7, 1, 1, 2, 2, 2, 2, 1, 7, 7, 7, 7, 7, 7, 7, 3, 7, 7, 7, 3, 7, 1, 1, 2, 2, 2, 2, 1, 1, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 1, 2, 2, 2, 1, 1, 1, 7, 3, 7, 7, 7, 7, 3, 7, 7, 7, 3, 7, 7, 1, 1, 2, 2, 2, 1, 1, 7, 7, 7, 3, 7, 7, 7, 7, 7, 7, 7, 7, 7, 1, 1, 2, 2, 2, 2, 1, 7, 3, 7, 7, 7, 7, 4, 7, 4, 7, 7, 7, 7, 1, 2, 2, 1, 2, 2, 1, 7, 7, 7, 7, 3, 7, 7, 7, 7, 7, 7, 4, 1, 1, 2, 1, 2, 2, 2, 1, 7, 7, 7, 7, 7, 7, 7, 7, 7, 4, 7, 7, 1, 2, 2, 1, 2, 2, 1, 1, 7, 4, 7, 7, 4, 7, 7, 7, 7, 3, 7, 7, 1, 1, 2, 2, 2, 2, 1, 7, 7, 3, 7, 7, 7, 4, 7, 7, 7, 7, 7, 7, 7, 1, 2, 2, 2, 2, 1, 7, 7, 7, 7, 3, 7, 7, 7, 3, 7, 7, 7, 7, 7, 1, 2, 2, 2, 2, 1, 1, 7, 3, 7, 4, 7, 7, 7, 7, 7, 7, 4, 7, 7, 1, 1, 2, 2, 2, 2, 1, 7, 7, 7, 3, 7, 7, 7, 3, 7, 3, 7, 7, 7, 1, 2, 2, 1, 2, 2, 1, 7, 7, 7, 7, 7, 7, 4, 7, 7, 7, 7, 7, 7, 1, 2, 2, 2, 2, 1, 1, 7, 4, 7, 4, 7, 4, 7, 7, 7, 4, 7, 7, 1, 1, 2, 2, 2, 2, 1, 7, 7, 3, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 1, 2, 2, 1, 2, 1, 1, 7, 7, 7, 7, 7, 7, 3, 7, 3, 7, 7, 7, 7, 1, 2, 1, 1 };

void print_text(char *text, int x, int y) {
	gotogxy(x, y);
	gprintf("%s", text);
	gotogxy(0, 0);
}

const unsigned char window_map[] = {
    // 20x4 tilemap for the window (80 bytes total)
    // Each number refers to the tile index from window_tiles.h (offset by 128)
    ' '-'a'+9, 'p'-'a'+9, 'r'-'a'+9, 'e'-'a'+9, 's'-'a'+9, 's'-'a'+9, ' '-'a'+9, 'k'-'a'+9, 'e'-'a'+9, 'y'-'a'+9, ' '-'a'+9, 't'-'a'+9, 'o'-'a'+9, ' '-'a'+9, 's'-'a'+9, 't'-'a'+9, 'a'-'a'+9, 'r'-'a'+9, 't'-'a'+9
};

const unsigned char win_map[] = {
    // 20x4 tilemap for the window (80 bytes total)
    // Each number refers to the tile index from window_tiles.h (offset by 128)
    ' '-'a'+9, ' '-'a'+9, ' '-'a'+9, ' '-'a'+9, ' '-'a'+9, ' '-'a'+9, 'y'-'a'+9, 'o'-'a'+9, 'u'-'a'+9, ' '-'a'+9, 'w'-'a'+9, 'i'-'a'+9, 'n'-'a'+9, ' '-'a'+9, 'z'-'a'+9+16, ' '-'a'+9, ' '-'a'+9, ' '-'a'+9, ' '-'a'+9
};

const unsigned char lose_map[] = {
    // 20x4 tilemap for the window (80 bytes total)
    // Each number refers to the tile index from window_tiles.h (offset by 128)
    ' '-'a'+9, ' '-'a'+9, ' '-'a'+9, ' '-'a'+9, ' '-'a'+9, ' '-'a'+9, 'y'-'a'+9, 'o'-'a'+9, 'u'-'a'+9, ' '-'a'+9, 'l'-'a'+9, 'o'-'a'+9, 's'-'a'+9, 'e'-'a'+9, 'z'-'a'+9+13, 'z'-'a'+9+13, 'z'-'a'+9+13, ' '-'a'+9, ' '-'a'+9
};

void set_start_room() {
    current_room = room_1;
    set_bkg_tiles(0, 0, 20, 18, room_1);
}

void set_start_screen() {
    set_bkg_tiles(0, 0, 20, 32, start_screen);
    current_room = start_screen;
}

void window_win() {
    SHOW_WIN;
    set_start_screen();
    set_win_tiles(0, 1, 19, 1, win_map);
    move_win(7, 120);
}

void window_lose() {
    SHOW_WIN;
    set_start_screen();
    set_win_tiles(0, 1, 19, 1, lose_map);
    move_win(7, 120);
}

int player_x = 80;
int player_y = 80;
void set_end_screen() {
    player_x = 88;
    player_y = 56;
    while(1) {
        scroll_bkg(0, 1);
        draw_player();
        vsync();
    }
}

unsigned char get_bkg_tile_from_pos(uint8_t x, uint8_t y) {
    int column  = (x / 8) - 1;
    int row     = (y / 8) - 1;
    // printf("x%d, y%d = %d", column, row, current_room[column + (row*20)]);
    if (column < 0 || row < 0 || column >= 19 || row >= 18)
        return 7;
    return current_room[column + (row*20)];
}

//Is winner ?
char you_win = 0;
#define path_size 32
char path[path_size] = {0};
char path_hash[] = {25, 25, 8, 22, 7, 0, 25, 17, 8, 22, 17, 25, 0, 30, 7, 17};
char path_num = 0;
void update_path(char dir) {
    path[path_num] = dir; 
    path_num++;
    if (path_num > path_size) {
        // Lose game
        window_lose();
        set_end_screen();
    }
}
int test_win() {
    you_win = 0;
    // printf("%s", path);
    // path is "U...U"
    if (path_num == 32) {
        for (int i=0; i<16; i++) {
            // printf("char = %c", path[2*i + 1]);
            if (path_hash[i] != (path[i*2] ^ path[i*2+1])) {
                // printf("%d != %d", path_hash[i], path[i*2] ^ path[i*2+1]);
                return you_win = 0;            
            }
        }
        you_win = 1;
    }
    return you_win;
}

void update_player(uint8_t joypad_state) {
    int old_x = player_x;
    int old_y = player_y;
    // Move the sprite based on joypad input
    unsigned char local_tile;
    unsigned char local_tile2;
    // printf("x=%d y=%d", player_x, player_y);
    int player_speed = 2;
    if(joypad_state & J_UP) {
        player_y -= player_speed;
        local_tile  = get_bkg_tile_from_pos(player_x, player_y-7);
        local_tile2 = get_bkg_tile_from_pos(player_x+7, player_y-7);
    }
    else if(joypad_state & J_DOWN) {
        player_y += player_speed;
        local_tile  = get_bkg_tile_from_pos(player_x, player_y);
        local_tile2 = get_bkg_tile_from_pos(player_x+7, player_y);
    }
    if (local_tile == 1 || local_tile == 2 || local_tile2 == 1 || local_tile2 == 2) {
        player_y = old_y;
    }
    
    if(joypad_state & J_LEFT) {
        player_x -= player_speed;
        local_tile  = get_bkg_tile_from_pos(player_x, player_y-7);
        local_tile2 = get_bkg_tile_from_pos(player_x, player_y);
    }
    else if(joypad_state & J_RIGHT) {
        player_x += player_speed;
        local_tile  = get_bkg_tile_from_pos(player_x+7, player_y-7);
        local_tile2 = get_bkg_tile_from_pos(player_x+7, player_y);
    }
    if (local_tile == 1 || local_tile == 2 || local_tile2 == 1 || local_tile2 == 2) {
        player_x = old_x;
    }

    // Got treasure !
    if (current_room == room_3 && (((player_x / 8)-1) == 10 && ((player_y / 8)-1) == 6 ) && test_win()) {
        set_bkg_data(0, 58, background_tileset);
        window_win();
        set_end_screen();
    }    
}

int time = 0;
int player_sprite_id = 0;
void draw_player() {
    time++;
    if (time >= 20) {
        time = 0;
        player_sprite_id = !player_sprite_id;
    }
    set_sprite_tile(0, player_sprite_id);
    move_sprite(0, player_x, player_y);
}

void set_mid_room() {
    current_room = room_2;
    set_bkg_tiles(0, 0, 20, 18, room_2);
    hide_sprite(1);
}

void win_room(char win) {
    current_room = room_3;
    set_bkg_tiles(0, 0, 20, 18, room_3);
    // set treasure
    // printf("win=%d ; %s", win, path);
    if (win) {
        move_sprite(1, 88, 60);
    }
}



void update_room() {
    //set current_room au passage !
    if (player_y <= 15 && current_room == room_2) {
        // printf("room up !");
        update_path('U');
        win_room(test_win()); player_x = 88; player_y = 151;
    }
    if (player_y <= 15) {
        // printf("room up !");
        update_path('U');
        set_mid_room(); player_x = 88; player_y = 151;
    }
    if (player_y >= 152) {
        // printf("room down !");
        update_path('D');
        set_mid_room(); player_x = 88; player_y = 16;
    }
    if (player_x >= 160) {
        // printf("room right !");
        update_path('R');
        set_mid_room(); player_x = 8; player_y = 88;
    }
    if (player_x <= 7) {
        // printf("room left !");
        update_path('L');
        set_mid_room(); player_x = 159; player_y = 88;
    }
}

void main(void)
{
    DISPLAY_ON;
    SHOW_BKG;
    // Load & set our background data
    set_bkg_data(0, 58, background_tileset);
    // The gameboy screen is 160px wide by 144px tall
    // We deal with tiles that are 8px wide and 8px tall
    // 160/8 = 20, and 144/8 = 18
    set_start_screen();

    // Window
    SHOW_WIN;
    set_win_tiles(0, 1, 19, 1, window_map);
    move_win(7, 120);

    // Game var
    char game_started = 0;

    // Press key to start
    while(game_started == 0) {
        if(joypad())
            game_started = 1;
        scroll_bkg(0, 1);
        vsync();
    }
    HIDE_WIN;
    
    set_start_room();
    move_bkg(0, 0);
    // player sprite
    SHOW_SPRITES;
    set_sprite_data(0, 3, sprite_tiles);
    set_sprite_tile(0, player_sprite_id); // Start with the first sprite tile
    move_sprite(0, player_x, player_y);
    // treasuer sprite
    set_sprite_tile(1, 2);
    hide_sprite(1);

    // Game loop
    uint8_t i;
    while(1) {
        i = joypad();
        update_player(i);
        update_room();
        draw_player();

        vsync();
    }

    // set_bkg_palette(0,1,LaroldsJubilantJunkyard_pallette);
}